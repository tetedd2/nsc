<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>MoneySkillz ‚Äì ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏Å‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="theme-darkmode.css">
  <style>
    html, body {
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #e0f7fa 80%, #b2ebf2 100%);
      font-family: 'Kanit', sans-serif;
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
    }
    .main-container {
      max-width: 430px;
      margin: 0 auto;
      margin-top: 42px;
      margin-bottom: 42px;
      padding: 24px 12px 24px 12px;
      border-radius: 22px;
      background: rgba(255,255,255,0.69);
      box-shadow: 0 8px 32px 0 rgba(0,0,0,0.11), 0 2px 6px #b2dfdb44;
      backdrop-filter: blur(9px);
      border: 1.7px solid rgba(120,200,200,0.10);
      min-height: 85vh;
      display: flex; flex-direction: column; align-items: center;
      justify-content: flex-start;
      overflow-x: hidden;
    }
    .logo-circle {
      width: 76px; height: 76px; background: #23b1ab;
      border-radius: 50%; display: flex;
      align-items: center; justify-content: center;
      margin: 0 auto 18px auto;
      box-shadow: 0 2px 17px #23b1ab42;
    }
    .logo-circle span {
      color: #fff; font-size: 2.7em; font-weight: bold; letter-spacing: 1px;
      text-shadow: 0 3px 18px #ffffff44;
    }
    .app-title {
      font-size: 1.8em;
      font-weight: bold;
      color: #00796b;
      margin-bottom: 3px;
      text-align: center;
      letter-spacing: 1px;
    }
    .app-desc {
      color: #008c7d;
      text-align: center;
      font-size: 1.08em;
      margin-bottom: 24px;
      margin-top: 2px;
      font-weight: 400;
    }
    .menu-list {
      display: flex; flex-direction: column; gap: 17px;
      width: 100%;
      margin-top: 8px;
      box-sizing: border-box;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢, ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á, ‡∏¢‡∏≤‡∏Å (‡∏™‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô) */
    .menu-btn-common {
      display: flex; align-items: center;
      width: 100%;
      box-sizing: border-box;
      padding: 17px 18px;
      background-color: #23b1ab; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
      color: #fff;
      font-weight: 700;
      font-size: 1.1em;
      border: none; border-radius: 14px;
      cursor: pointer;
      transition: background 0.17s, transform 0.14s;
      outline: none;
      letter-spacing: 0.5px;
      text-align: left;
      position: relative;
      margin: 0;
      justify-content: flex-start;
      text-decoration: none;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏ï‡πâ‡∏° (‡∏™‡∏µ‡∏™‡πâ‡∏°) */
    .menu-btn-timed {
      display: flex; align-items: center;
      width: 100%;
      box-sizing: border-box;
      padding: 17px 18px;
      background-color: #ff9800; /* ‡∏™‡∏µ‡∏™‡πâ‡∏° */
      color: #fff;
      font-weight: 700;
      font-size: 1.1em;
      border: none; border-radius: 14px;
      cursor: pointer;
      transition: background 0.17s, transform 0.14s;
      outline: none;
      letter-spacing: 0.5px;
      text-align: left;
      position: relative;
      margin: 0;
      justify-content: flex-start;
      text-decoration: none;
    }

    /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Ñ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠ hover */
    .menu-btn:hover {
      transform: scale(1.05); /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏ï‡∏≠‡∏ô hover */
    }

    /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Ñ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î */
    .menu-btn:active {
      transform: scale(0.97); /* ‡∏Ç‡∏¢‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î */
    }

    .score-summary {
      width: 100%;
      text-align: center;
      font-size: 1.14em;
      margin-top: 12px;
      margin-bottom: 5px;
      color: #159988;
      background: #e0f7fae6;
      border-radius: 11px;
      padding: 9px 0 7px 0;
      font-weight: 600;
      box-shadow: 0 1px 9px #b2dfdb24;
      letter-spacing: 0.5px;
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î */
    .high-score-summary {
      width: 100%;
      text-align: center;
      font-size: 1.14em;
      margin-top: 8px;
      margin-bottom: 5px;
      color: #fff;
      background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
      border-radius: 11px;
      padding: 9px 0 7px 0;
      font-weight: 600;
      box-shadow: 0 3px 12px #4caf5033;
      letter-spacing: 0.5px;
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö EXP */
    .exp-summary {
      width: 100%;
      text-align: center;
      font-size: 1.14em;
      margin-top: 8px;
      margin-bottom: 5px;
      color: #fff;
      background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%); /* ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á */
      border-radius: 11px;
      padding: 9px 0 7px 0;
      font-weight: 600;
      box-shadow: 0 3px 12px #9c27b033;
      letter-spacing: 0.5px;
    }

    .leaderboard-preview {
      width: 100%; margin-top: 16px; margin-bottom: 5px;
      background: #f8fdfd; border-radius: 12px;
      box-shadow: 0 1px 10px #b2dfdb20;
      padding: 9px 9px 3px 9px;
      color: #0a827a;
      font-size: 1em;
    }
    .leaderboard-preview-title {
      color: #13aaa7; font-weight: bold; margin-bottom: 6px;
      font-size: 1.05em;
      letter-spacing: 0.2px;
      text-align: left;
    }
    .leaderboard-row {
      display: flex; justify-content: space-between; margin-bottom: 4px;
      font-size: 1em; font-weight: 500;
    }

    .footer {
      margin-top: auto; text-align:center; color:#9abfc1; font-size:0.97em;
      letter-spacing: 0.5px;
      padding-top: 20px;
    }
    
    /* === ‡πÇ‡∏Ñ‡πâ‡∏î CSS ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Back ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô === */
    .top-left-back-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 50px;
      height: 50px;
      background: rgba(255, 255, 255, 0.8);
      color: #00796B;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡∏®‡∏£ */
      font-weight: bold;
      text-decoration: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.2s ease-in-out;
    }
    .top-left-back-btn:hover {
      transform: scale(1.1);
      background: rgba(255, 255, 255, 1);
    }
    .top-left-back-btn:active {
      transform: scale(0.95);
    }
    body.dark-mode .top-left-back-btn {
      background: rgba(40, 40, 40, 0.8);
      color: #4DB6AC;
    }
    /* === ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÇ‡∏Ñ‡πâ‡∏î CSS ‡πÉ‡∏´‡∏°‡πà === */


    @media (max-width:540px) {
      .main-container { max-width: 99vw; min-height: 99vh;}
      .menu-btn { font-size: 0.99em; padding: 14px 8px;}
      .logo-circle { width: 60px; height: 60px;}
      .logo-circle span { font-size: 2em;}
      .score-summary { font-size: 1em;}
      .high-score-summary { font-size: 1em;}
      .exp-summary { font-size: 1em;}
      .leaderboard-preview { font-size: 0.97em;}
    }
  </style>
</head>
<body>
  <a href="game-mode.html" class="top-left-back-btn">‚Üê</a>

  <div class="main-container">
    <div class="logo-circle"><span>‡∏ø</span></div>
    <div class="app-title">MoneySkillz</div>
    <div class="app-desc">
      ‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô<br>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏•‡πà‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!
    </div>

    <div class="score-summary" id="totalScore">
      ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤: <span id="totalScoreValue">0</span>
    </div>

    <div class="high-score-summary" id="highScore">
      üèÜ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: <span id="highScoreValue">0</span>
    </div>

    <div class="exp-summary" id="totalExp">
      üåü EXP ‡∏£‡∏ß‡∏°: <span id="totalExpValue">0</span>
      <span id="userIdDisplay" style="font-size:0.7em; margin-left: 10px;"></span>
    </div>

    <div class="menu-list">
      <a href="match-easy.html" class="menu-btn menu-btn-common" data-difficulty="easy">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢</a>
      <a href="match-medium.html" class="menu-btn menu-btn-common" data-difficulty="medium">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</a>
      <a href="match-hard.html" class="menu-btn menu-btn-common" data-difficulty="hard">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡∏≤‡∏Å</a>
      <a href="timed-score.html" class="menu-btn menu-btn-timed" data-difficulty="timed">‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏ï‡πâ‡∏°</a>
      <a href="leaderboard.html" class="menu-btn menu-btn-common">‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</a>
    </div>

    <div class="leaderboard-preview" id="leaderboardPreview" style="display:none;">
      <div class="leaderboard-preview-title">TOP 3 ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
      <div id="leaderboardRows"></div>
      <div style="text-align:right; margin-top:5px;">
        <a href="leaderboard.html" style="color:#11aaa7;text-decoration:underline;font-size:0.97em;">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
      </div>
    </div>

    <div class="footer">
      &copy; 2025 MoneySkillz &mdash; ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    </div>
  </div>
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Initialize Firebase with the provided configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBjLBl1sEGgQLyng51rW25b434bJ0opVc4",
      authDomain: "myapplication-bd04c034.firebaseapp.com",
      databaseURL: "https://myapplication-bd04c034-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "myapplication-bd04c034",
      storageBucket: "myapplication-bd04c034.firebasestorage.app",
      messagingSenderId: "49782830313",
      appId: "1:49782830313:web:c81b5d86a937f22d296c78"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let userId = null;
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î userId
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        userId = user.uid;
        document.getElementById("userIdDisplay").textContent = `(ID: ${userId.substring(0, 8)}...)`;
      } else {
        try {
          // ‡∏´‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô (anonymous)
          const anonymousUserCredential = await signInAnonymously(auth);
          userId = anonymousUserCredential.user.uid;
          document.getElementById("userIdDisplay").textContent = `(ID: ${userId.substring(0, 8)}...)`;
        } catch (error) {
          console.error("Error signing in anonymously:", error);
          // ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ UUID ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
          userId = crypto.randomUUID(); 
          document.getElementById("userIdDisplay").textContent = `(ID: ${userId.substring(0, 8)} - fallback)`;
        }
      }
      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• EXP ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏î‡πâ userId ‡πÅ‡∏•‡πâ‡∏ß
      await fetchAndDisplayExp();
    });

    // ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡πà‡∏≤ EXP ‡∏à‡∏≤‡∏Å Firestore
    async function fetchAndDisplayExp() {
      if (!userId) return; // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ userId ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠
      try {
        const userRef = doc(db, `users`, userId);
        // ‡πÉ‡∏ä‡πâ onSnapshot ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
        onSnapshot(userRef, (docSnap) => {
          if (docSnap.exists()) {
            const data = docSnap.data();
            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ xp ‡∏à‡∏≤‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏´‡∏£‡∏∑‡∏≠ 0 ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ
            document.getElementById("totalExpValue").textContent = data.xp || 0; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å data.totalExp ‡πÄ‡∏õ‡πá‡∏ô data.xp
          } else {
            // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
            document.getElementById("totalExpValue").textContent = 0;
            setDoc(userRef, { xp: 0 }, { merge: true }); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å totalExp: 0 ‡πÄ‡∏õ‡πá‡∏ô xp: 0
          }
        });
      } catch (error) {
        console.error("Error setting up user data listener:", error);
      }
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤ EXP ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Firestore
    async function addExp(expAmount) {
      if (!userId) return; // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ userId ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠
      try {
        const userRef = doc(db, `users`, userId);
        const docSnap = await getDoc(userRef);
        let currentExp = 0;
        if (docSnap.exists()) {
          // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ xp ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
          currentExp = docSnap.data().xp || 0; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å docSnap.data().totalExp ‡πÄ‡∏õ‡πá‡∏ô docSnap.data().xp
        }
        const newExp = currentExp + expAmount;
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ü‡∏¥‡∏•‡∏î‡πå xp ‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        await setDoc(userRef, { xp: newExp }, { merge: true }); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å totalExp: newExp ‡πÄ‡∏õ‡πá‡∏ô xp: newExp
        console.log(`EXP added to Firebase (xp field): ${expAmount}. New total xp: ${newExp}`); // ‡πÄ‡∏û‡∏¥‡πà‡∏° log
      } catch (error) {
        console.error("Error adding EXP:", error);
      }
    }
    
    // ‡∏Ñ‡πà‡∏≤ EXP ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏° (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ)
    const EXP_VALUES = { easy: 100, medium: 200, hard: 300, timed_multiplier: 5 };

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏° EXP ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏à‡∏ö (‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π)
    function addExpForGameCompletion(difficulty, score = 0) {
      let expGained = 0;
      if (difficulty in EXP_VALUES) {
        expGained = EXP_VALUES[difficulty];
      } else if (difficulty === 'timed') {
        expGained = score * EXP_VALUES.timed_multiplier;
      }
      if (expGained > 0) addExp(expGained);
      console.log(`Simulated game completion for difficulty: ${difficulty}, Score: ${score}, EXP Gained: ${expGained}`); // ‡πÄ‡∏û‡∏¥‡πà‡∏° log
    }
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listener ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏Å‡∏°
    document.querySelectorAll('.menu-btn').forEach(button => {
      button.addEventListener('click', (event) => {
        const difficulty = event.currentTarget.dataset.difficulty;
        if (difficulty) {
          // ‡πÉ‡∏ä‡πâ setTimeout ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° EXP ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
          // ‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡∏•‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÜ
          setTimeout(() => {
            const score = difficulty === 'timed' ? 50 : 0; // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
            addExpForGameCompletion(difficulty, score);
          }, 1000);
        }
      });
    });

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≤‡∏Å Local Storage
    function showTotalScore() {
      let val = localStorage.getItem("money_score_timed");
      document.getElementById("totalScoreValue").textContent = val ? parseInt(val) : 0;
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Local Storage
    function showHighScore() {
      let highScore = localStorage.getItem("arcadeHighScore");
      let highScoreValue = highScore ? parseInt(highScore) : 0;
      document.getElementById("highScoreValue").textContent = highScoreValue;
      document.getElementById("highScore").style.display = highScoreValue === 0 ? "none" : "block";
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
    showTotalScore();
    showHighScore();

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å Local Storage
    function showLeaderboardPreview() {
      let leaderboard = JSON.parse(localStorage.getItem("money_leaderboard")||"[]");
      if(leaderboard && leaderboard.length > 0) {
        leaderboard.sort((a,b)=>b.score-a.score);
        let html = leaderboard.slice(0,3).map((r,i)=>
          `<div class="leaderboard-row"><span>${i+1}. ${r.name}</span> <span>${r.score}</span></div>`
        ).join('');
        document.getElementById("leaderboardRows").innerHTML = html;
        document.getElementById("leaderboardPreview").style.display = '';
      }
    }
    showLeaderboardPreview();
    
  </script>
  <script src="darkmode-toggle.js"></script>
</body>
</html>