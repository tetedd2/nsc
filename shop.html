<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üõí ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ - MoneySkillz</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="dashboard.css">
  <link rel="stylesheet" href="theme-darkmode.css">
  <style>
    .back-btn { font-size:1.15em; background:var(--primary-color,#09a79d); color:#fff; border:none; border-radius:10px;
                padding:10px 22px; margin-bottom:24px; cursor:pointer; box-shadow:0 2px 8px var(--shadow-color);}
    .back-btn:hover { background:var(--primary-darker,#087e7e);}
    .shop-header { text-align:center; margin-top:24px; }
    .shop-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px 12px;
      margin-top: 12px;
    }
    .shop-item {
      background: #f6f6f6;
      border: 2px solid #eee;
      border-radius: 20px;
      width: 130px;
      min-height: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      margin: 10px 10px 20px 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      padding: 16px 8px 10px 8px;
      transition: all 0.2s;
    }
    .shop-item .item-icon {
      font-size: 2.7em;
      margin-bottom: 2px;
    }
    .shop-item .item-name {
      font-size: 1em;
      font-weight: 600;
      text-align: center;
      margin: 8px 0 3px 0;
      line-height: 1.2;
      word-break: break-word;
    }
    .shop-item .item-price {
      font-size: 0.98em;
      color: #2980b9;
      margin-bottom: 8px;
    }
    .shop-item button {
      margin-top: auto;
      background: #09a79d;
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 6px 18px;
      font-size: 1em;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s;
    }
    .shop-item.unlocked { background: #b4f1c6; color: #fff; border-color: #229954; }
    .shop-item.unlocked button { background: #aaa; color: #fff; cursor: default; }
    .shop-item.locked { filter: grayscale(40%); opacity: 0.85; }
    .shop-item.unlocked .item-price { color: #fff; }
  </style>
</head>
<body>
  <div class="container card-section badge-section">
    <button class="back-btn" onclick="window.location.href='dashboard.html'">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    <div class="shop-header">
      <h2><span class="icon">üõí</span> ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏≠‡πÄ‡∏ó‡∏°/‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h2>
      <div class="summary-item" style="max-width:300px;margin:auto;margin-bottom:24px;">
        <strong>‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</strong>
        <span class="amount" id="userCoins">0</span>
      </div>
    </div>
    <div class="shop-row" id="shopItemsRow"></div>
  </div>

  <!-- Firebase SDK & Shop Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import {
      getFirestore, doc, updateDoc, getDoc, arrayUnion, onSnapshot
    } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    // ----- config Firebase -----
    const firebaseConfig = {
      apiKey: "AIzaSyBjLBl1sEGgQLyng51rW25b434bJ0opVc4",
      authDomain: "myapplication-bd04c034.firebaseapp.com",
      databaseURL: "https://myapplication-bd04c034-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "myapplication-bd04c034",
      storageBucket: "myapplication-bd04c034.firebasestorage.app",
      messagingSenderId: "49782830313",
      appId: "1:49782830313:web:c81b5d86a937f22d296c78"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ---- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÉ‡∏´‡∏°‡πà‡πÜ ‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ----
    const shopItems = [
      { id: 'bank', name: '‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ô‡∏±‡∏Å‡∏≠‡∏≠‡∏°', price: 100, icon: 'üè¶' },
      { id: 'invest', name: '‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ô‡∏±‡∏Å‡∏•‡∏á‡∏ó‡∏∏‡∏ô', price: 120, icon: 'üíπ' },
      { id: 'planner', name: '‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô', price: 110, icon: 'üìù' },
      { id: 'debt', name: '‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏õ‡∏•‡∏≠‡∏î‡∏´‡∏ô‡∏µ‡πâ', price: 90, icon: 'üí∏' },
      { id: 'income', name: '‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á', price: 80, icon: 'üåê' },
      { id: 'entrepreneur', name: '‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£', price: 150, icon: 'üí°' },
      { id: 'dreamer', name: '‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ô‡∏±‡∏Å‡∏ù‡∏±‡∏ô', price: 70, icon: 'üí≠' },
      { id: 'superstar', name: '‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏î‡∏≤‡∏ß‡∏£‡∏∏‡πà‡∏á', price: 200, icon: 'üåü' },
      { id: 'gold', name: '‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥', price: 300, icon: 'ü™ô' }
    ];

    // ---- ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô (‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏´‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ) ----
    function renderShop(user) {
      document.getElementById('userCoins').textContent = user.coins || 0;
      const inventory = user.inventory || [];
      const row = document.getElementById('shopItemsRow');
      row.innerHTML = '';

      shopItems.forEach(item => {
        const bought = inventory.includes(item.id);
        const el = document.createElement('div');
        el.className = 'shop-item ' + (bought ? 'unlocked' : 'locked');
        el.innerHTML = `
          <div class="item-icon">${item.icon}</div>
          <div class="item-name">${item.name}</div>
          <div class="item-price">${item.price} ü™ô</div>
          <button ${bought ? 'disabled' : ''}>
            ${bought ? '‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß' : '‡∏ã‡∏∑‡πâ‡∏≠'}
          </button>
        `;
        el.querySelector('button').onclick = async () => {
          if (bought) return;
          if ((user.coins || 0) < item.price) {
            alert("‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡∏û‡∏≠!");
            return;
          }
          const ok = confirm(`‡∏ã‡∏∑‡πâ‡∏≠ ${item.name} ‡πÉ‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤ ${item.price} ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç?`);
          if (!ok) return;
          await buyItem(auth.currentUser.uid, item.id, item.price);
        };
        row.appendChild(el);
      });
    }

    // ---- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á ----
    async function buyItem(uid, itemId, price) {
      const userRef = doc(db, 'users', uid);
      const userSnap = await getDoc(userRef);
      if (!userSnap.exists()) return alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
      const user = userSnap.data();
      if ((user.coins || 0) < price) return alert('‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡∏û‡∏≠');
      await updateDoc(userRef, {
        coins: (user.coins || 0) - price,
        inventory: arrayUnion(itemId)
      });
      alert('‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
    }

    // ---- ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ----
    onAuthStateChanged(auth, user => {
      if (!user) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
        window.location.href = 'login.html';
        return;
      }
      onSnapshot(doc(db, 'users', user.uid), snap => {
        const data = snap.data() || {};
        renderShop(data);
      });
    });
  </script>
  <script src="darkmode-toggle.js"></script>
</body>
</html>
